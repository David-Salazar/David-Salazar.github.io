<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.262">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">
<meta name="dcterms.date" content="2020-07-31">

<title>David Salazar - Causality: Testing Identifiability</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">David Salazar</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html">
 <span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/David-Salazar"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/DavidSalazarVir"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Causality: Testing Identifiability</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 31, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#all-you-can-estimate-markov-models" id="toc-all-you-can-estimate-markov-models" class="nav-link" data-scroll-target="#all-you-can-estimate-markov-models">All you can estimate: Markov Models</a></li>
  <li><a href="#semi-markovian-models" id="toc-semi-markovian-models" class="nav-link" data-scroll-target="#semi-markovian-models">Semi-Markovian Models</a></li>
  <li><a href="#confounded-components" id="toc-confounded-components" class="nav-link" data-scroll-target="#confounded-components">Confounded components</a></li>
  <li><a href="#a-general-criteria-for-identification" id="toc-a-general-criteria-for-identification" class="nav-link" data-scroll-target="#a-general-criteria-for-identification">A general criteria for identification</a>
  <ul class="collapse">
  <li><a href="#intuition" id="toc-intuition" class="nav-link" data-scroll-target="#intuition">Intuition</a></li>
  </ul></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a>
  <ul class="collapse">
  <li><a href="#first-example" id="toc-first-example" class="nav-link" data-scroll-target="#first-example">First Example</a></li>
  <li><a href="#second-example" id="toc-second-example" class="nav-link" data-scroll-target="#second-example">Second Example</a></li>
  <li><a href="#third-example" id="toc-third-example" class="nav-link" data-scroll-target="#third-example">Third example</a></li>
  </ul></li>
  <li><a href="#what-about-a-necessary-condition-for-identifiability" id="toc-what-about-a-necessary-condition-for-identifiability" class="nav-link" data-scroll-target="#what-about-a-necessary-condition-for-identifiability">What about a necessary condition for identifiability?</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<p>We’ve defined causal effects as an <a href="https://david-salazar.github.io/2020/07/22/causality-invariance-under-interventions/">interventional</a> distribution and posit two identification strategies to estimate them: the <a href="https://david-salazar.github.io/2020/07/25/causality-to-adjust-or-not-to-adjust/">back-door</a> and the <a href="https://david-salazar.github.io/2020/07/30/causality-the-front-door-criterion/">front-door</a> criteria. However, we cannot always use these criteria; sometimes, we <em>cannot measure the necessary variables</em> to use either of them.</p>
<p>More generally, given a causal model and some incomplete set of measurements, when is <em>the causal effect</em> of interest <strong>identifiable?</strong> In this blog post, we will develop a <strong>graphical criterion</strong> to answer this question by exploiting the concept of c-components. Finally, we will put the criterion in practice with multiple examples.</p>
</section>
<section id="all-you-can-estimate-markov-models" class="level2">
<h2 class="anchored" data-anchor-id="all-you-can-estimate-markov-models">All you can estimate: Markov Models</h2>
<p>When we can obtain measurements of all the variables in the causal model, we say that our causal model is Markovian. In this case, the <strong>adjustment formula</strong> is our identification strategy: any causal effect <span class="math inline">\(X \rightarrow Y\)</span> is identifiable if we have measurements of the parents of <span class="math inline">\(X\)</span>, <span class="math inline">\(Pa(X)\)</span>.</p>
<p><span class="math display">\[
P(Y=y|\text{do}(X=x)) = \sum_{z} P(Y=y | X=x, Pa(X)=z) P(Pa(X)=z)
\]</span> What happens when you cannot observe the parents of <span class="math inline">\(x\)</span>?</p>
</section>
<section id="semi-markovian-models" class="level2">
<h2 class="anchored" data-anchor-id="semi-markovian-models">Semi-Markovian Models</h2>
<p>If a variable that is unobserved has two descendants in the graph, the Markovian property is violated. We may or may not be able to use the adjustment formula. For example, if one of the parents of <span class="math inline">\(X\)</span> is unobserved, we cannot use it as our identification strategy. Even then, we <strong>may be able</strong> to use either the back-door or the front-door criteria.</p>
<p>Let’s start studying the problem with the following example. In this case, a <em>bi-directed dashed edge</em> represents a <strong>hidden common cause</strong> between the variables. We refer to all unmeasured variables by <span class="math inline">\(U\)</span>, all of the observed variables by <span class="math inline">\(V\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="fu">dagify</span>(x <span class="sc">~</span><span class="er">~</span> z2,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                  z1 <span class="sc">~</span> x,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                  z1 <span class="sc">~</span> z2,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                  z1 <span class="sc">~</span><span class="er">~</span> y,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                  y <span class="sc">~</span> x <span class="sc">+</span>z1 <span class="sc">+</span>z2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="2020-07-31-causality-testing-identifiability_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To identify the causal effect of <span class="math inline">\(X\)</span> on all of the other observed variables <span class="math inline">\(v\)</span>, we must be able to estimate the post intervention probabilities, <span class="math inline">\(P(v | do(X))\)</span>, from the pre-intervention probabilities that we can observe.</p>
<p>To begin to study this question, we must remember that our causal model is simultaneously a probabilistic model. In particular, they induce a <strong>decomposition of the joint probability distribution</strong> because each variable is independent of all its non-descendants given its direct parents in the graph. However, when our model contains <em>unobserved confounders</em>, we must <em>marginalize them</em> in order to obtain the joint probability distribution of the observed variables:</p>
<p><span class="math display">\[
P(v) = \sum_u \prod_i P(v_i| pa_i, u^i) P(u)
\]</span></p>
<p>In this case, the decomposition of the observables is given by:</p>
<p><span class="math display">\[
\begin{aligned}
P(v)=&amp; \sum_{u_{1}} P\left(x \mid u_{1}\right) P\left(z_{2} \mid z_{1}, u_{1}\right) P\left(u_{1}\right) \\
&amp; \quad \sum_{u_2} P\left(z_{1} \mid x, u_{2}\right) P\left(y \mid x, z_{1}, z_{2}, u_{2}\right) P\left(u_{2}\right)
\end{aligned}
\]</span></p>
<p>Given that <span class="math inline">\(P(v|do(X=x))\)</span> represents an intervention, it can be represented by truncating the above expression such that we do not calculate the probability of <span class="math inline">\(X\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
P(v | do(X))=&amp; \sum_{u_{1}} P\left(z_{2} \mid z_{1}, u_{1}\right) P\left(u_{1}\right) \\
&amp; \cdot \sum_{u_2} P\left(z_{1} \mid x, u_{2}\right) P\left(y \mid x, z_{1}, z_{2}, u_{2}\right) P\left(u_{2}\right)
\end{aligned}
\]</span></p>
<p>Can we express <span class="math inline">\(P(v | do(X))\)</span> in terms of observed variables? First, we must take a brief de-tour by confounded components.</p>
</section>
<section id="confounded-components" class="level2">
<h2 class="anchored" data-anchor-id="confounded-components">Confounded components</h2>
<p>Notice that in both expressions the unobserved confounders partition into disjoint groups the observed variables: <strong>two variables are assigned to the same group if and only if they are connected by a bi-directed path</strong>. Each group, <span class="math inline">\(S_k\)</span>, is called a <strong>confounded</strong> component (c-component). In this case, we have two c-components that induce two factorizations (c-factors):</p>
<p><span class="math display">\[
Q_{1}=\sum_{u_{1}} P\left(x \mid u_{1}\right) P\left(z_{2} \mid z_{1}, u_{1}\right) P\left(u_{1}\right) \\
Q_{2}=\sum_{u_2} P\left(z_{1} \mid x, u_{2}\right) P\left(y \mid x, z_{1}, z_{2}, u_{2}\right) P\left(u_{2}\right)
\]</span></p>
<p>Notice that <strong>each (c-factor) <span class="math inline">\(Q_k\)</span> can be interpreted as the post-intervention distribution</strong> of the variables in <span class="math inline">\(S_k\)</span> under an intervention on all the other variables. Observe that we can express the joint observed distribution as a product of the c-factors:</p>
<p><span class="math display">\[
P(v) = Q_1 \cdot Q_2
\]</span> We can in turn define <span class="math inline">\(P(v | do(X))\)</span> in terms of <span class="math inline">\(Q_1, Q_2\)</span> <strong>if we marginalize <span class="math inline">\(P(x| u_1)\)</span> out of <span class="math inline">\(Q_1\)</span></strong>:</p>
<p><span class="math display">\[
P(v | do(X)) = Q_2 \sum_x Q_1 = Q_2 \cdot Q_1^x
\]</span></p>
<p>Therefore, <span class="math inline">\(P(v | do(X))\)</span> <em>will be identifiable</em> if: (a) we can compute the post-intervention probabilities <span class="math inline">\(Q_1, Q_2\)</span> in terms of pre-intervention probabilities; and (b) we can marginalize <span class="math inline">\(x\)</span> out of the estimated <span class="math inline">\(Q_1\)</span> with pre-intervention probabilities to compute <span class="math inline">\(Q_1^x\)</span>.</p>
<p>In fact, <a href="https://ftp.cs.ucla.edu/pub/stat_ser/R290-A.pdf">Tian and Pearl (PDF)</a> show that <strong>each c-factor is always identifiable</strong>. Therefore, the only condition to compute <span class="math inline">\(P(v | do(X))\)</span> if and only if <span class="math inline">\(Q_1^x\)</span> is identifiable, too. In this case:</p>
<p><span class="math display">\[
Q_1 = P(z_2 | x, z_1) P(x)
\]</span> Thus, we can marginalize <span class="math inline">\(x\)</span> out of <span class="math inline">\(Q_1\)</span> by summing over the values of <span class="math inline">\(X\)</span>.</p>
<p><span class="math display">\[
Q_1^x = \sum_{x'}  P(z_2 | x', z_1) P(x')
\]</span></p>
<p>Finally, our estimate for <span class="math inline">\(P(v | do(X))\)</span> is the following:</p>
<p><span class="math display">\[
P(v | do(X)) = \frac{P(v)}{Q_1} \sum_{x^{\prime}} P\left(z_{2} \mid x^{\prime}, z_{1}\right) P\left(x^{\prime}\right)
\]</span> Let’s generalize from this example.</p>
</section>
<section id="a-general-criteria-for-identification" class="level2">
<h2 class="anchored" data-anchor-id="a-general-criteria-for-identification">A general criteria for identification</h2>
<p>First, notice that for any graph with bi-directed paths, we can decompose the joint probability distribution by using the partition into c-components and their respective c-factors:</p>
<p><span class="math display">\[
P(v)=\prod_{j=1}^{k} Q_{j}  
\]</span></p>
<p>Also notice that the truncated distribution generated by intervening on <span class="math inline">\(x\)</span> can be represented with c-factors thus:</p>
<p><span class="math display">\[
P(v | do(X=x))=Q_{x}^{x} \prod_{i} Q_{i}
\]</span> Where <span class="math inline">\(Q_{x}^{x}\)</span> is the c-factor where <span class="math inline">\(x\)</span> is located once we remove <span class="math inline">\(x\)</span> from the factorization. Therefore, <span class="math inline">\(P(v | do(X=x)\)</span> is identifiable if <span class="math inline">\(Q_{x}^{x}\)</span> is identifiable, too.</p>
<p>In fact, <a href="https://ftp.cs.ucla.edu/pub/stat_ser/R290-A.pdf">Tian and Pearl (PDF)</a> show that <span class="math inline">\(Q_{x}^{x}\)</span> is identifiable if and only if there is no bi-directed path (<strong>a path with only bi-directed edges</strong>) connecting <span class="math inline">\(X\)</span> to any of its descendants. Therefore, we arrive at the following test to decide whether <span class="math inline">\(P(v | do(X=x)\)</span> is identifiable:</p>
<blockquote class="blockquote">
<p><span class="math inline">\(P(v | do(X=x)\)</span> is identifiable if and only if <strong>there is no bi-directed path connecting <span class="math inline">\(X\)</span> to any of its descendants</strong>.</p>
</blockquote>
<p>Notice that if <span class="math inline">\(P(v | do(X=x)\)</span> is identifiable so it is <span class="math inline">\(P(Y | do(X=x))\)</span>. Therefore, <strong>our criterion is sufficient to determine whether <span class="math inline">\(P(v | do(X=x))\)</span> is non-identifiable</strong>. Given that we are only interested in the causal effect on a single variable <span class="math inline">\(Y\)</span>, we can simplify the problem by only considering the subgraph of all the variables that are ancestors of <span class="math inline">\(Y\)</span></p>
<section id="intuition" class="level3">
<h3 class="anchored" data-anchor-id="intuition">Intuition</h3>
<p>What is the intuition of our identifiability test? The key to identifiability <em>lies not</em> in blocking back-door paths between X and Y but, rather, in <strong>blocking back-door paths between <span class="math inline">\(X\)</span> and any of its descendants that is an ancestor of <span class="math inline">\(Y\)</span></strong>. Thus, by blocking these paths, we can ascertain <em>which part of the association</em> we observe is <strong>spurious</strong> and which <em>genuinely causative</em>.</p>
<p>Let’s put this intuition into practice with the following examples.</p>
</section>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<section id="first-example" class="level3">
<h3 class="anchored" data-anchor-id="first-example">First Example</h3>
<p>Let’s start with our former example. Why was it identifiable? All the other variables are ancestors of <span class="math inline">\(Y\)</span>. Therefore, we cannot simplify the problem. We must look, then, if there is a bi-directed path between <span class="math inline">\(X\)</span> and its children:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_dagitty</span>(example, <span class="at">layout =</span> <span class="st">"nicely"</span>, <span class="at">seed =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">node_descendants</span>(<span class="st">"x"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linetype =</span> <span class="fu">if_else</span>(direction <span class="sc">==</span> <span class="st">"-&gt;"</span>, <span class="st">"solid"</span>, <span class="st">"dashed"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend, <span class="at">color =</span> descendant)) <span class="sc">+</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="fu">aes</span>(<span class="at">end_cap =</span> ggraph<span class="sc">::</span><span class="fu">circle</span>(<span class="dv">10</span>, <span class="st">"mm"</span>), <span class="at">edge_linetype =</span> linetype)) <span class="sc">+</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>() <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The causal effect of X is identifiable"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"There's no bi-directed path between X and its descendats"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2020-07-31-causality-testing-identifiability_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Given that there is no bi-directed path between <span class="math inline">\(X\)</span> and its descendants, the causal effect of <span class="math inline">\(X\)</span> is identifiable.</p>
</section>
<section id="second-example" class="level3">
<h3 class="anchored" data-anchor-id="second-example">Second Example</h3>
<p>Let’s take another example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>non_identifiable_example <span class="ot">&lt;-</span> <span class="fu">dagify</span>(x <span class="sc">~</span> z,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                                   x <span class="sc">~</span><span class="er">~~</span> z,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                                   x <span class="sc">~</span><span class="er">~</span> y,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                                   w <span class="sc">~</span> x,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                                   w <span class="sc">~</span><span class="er">~</span> z,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                                   y <span class="sc">~</span> w,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                                   y <span class="sc">~</span><span class="er">~</span> z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="2020-07-31-causality-testing-identifiability_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To find out whether the effect is identifiable, we look for a bi-directed path between <span class="math inline">\(X\)</span> and its descendants. If there is none, the effect is identifiable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_dagitty</span>(non_identifiable_example, <span class="at">layout =</span> <span class="st">"nicely"</span>, <span class="at">seed =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">node_descendants</span>(<span class="st">"x"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linetype =</span> <span class="fu">if_else</span>(direction <span class="sc">==</span> <span class="st">"-&gt;"</span>, <span class="st">"solid"</span>, <span class="st">"dashed"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend, <span class="at">color =</span> descendant)) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="fu">aes</span>(<span class="at">end_cap =</span> ggraph<span class="sc">::</span><span class="fu">circle</span>(<span class="dv">10</span>, <span class="st">"mm"</span>), <span class="at">edge_linetype =</span> linetype)) <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>() <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">col =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2020-07-31-causality-testing-identifiability_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notice that there is a bi-directed path from <span class="math inline">\(X\)</span> to <span class="math inline">\(W\)</span> (which is one of its descendants) through <span class="math inline">\(Z\)</span>. Then, according to our criterion, the effect is non-identifiable.</p>
</section>
<section id="third-example" class="level3">
<h3 class="anchored" data-anchor-id="third-example">Third example</h3>
<p>Finally, let’s end with the following example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>third_example <span class="ot">&lt;-</span> <span class="fu">dagify</span>(z1 <span class="sc">~</span> x <span class="sc">+</span> z2,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                        x <span class="sc">~</span> z2,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                        x <span class="sc">~</span><span class="er">~</span> z2,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                        x <span class="sc">~</span><span class="er">~</span> y, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                        z2 <span class="sc">~</span><span class="er">~</span> y,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                        z3 <span class="sc">~</span> z2,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                        x <span class="sc">~</span><span class="er">~</span> z3,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                        y <span class="sc">~</span> z1 <span class="sc">+</span> z3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="2020-07-31-causality-testing-identifiability_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As in the previous examples, we look for a bi-directed path between <span class="math inline">\(X\)</span> and its descendants.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_dagitty</span>(third_example, <span class="at">layout =</span> <span class="st">"nicely"</span>, <span class="at">seed =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">node_descendants</span>(<span class="st">"x"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linetype =</span> <span class="fu">if_else</span>(direction <span class="sc">==</span> <span class="st">"-&gt;"</span>, <span class="st">"solid"</span>, <span class="st">"dashed"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend, <span class="at">color =</span> descendant)) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="fu">aes</span>(<span class="at">end_cap =</span> ggraph<span class="sc">::</span><span class="fu">circle</span>(<span class="dv">10</span>, <span class="st">"mm"</span>), <span class="at">edge_linetype =</span> linetype)) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>() <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">col =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2020-07-31-causality-testing-identifiability_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notice that <span class="math inline">\(X\)</span> has no bi-directed path with its only descendant that is not <span class="math inline">\(Y\)</span>. Therefore, the causal effect is identifiable.</p>
</section>
</section>
<section id="what-about-a-necessary-condition-for-identifiability" class="level2">
<h2 class="anchored" data-anchor-id="what-about-a-necessary-condition-for-identifiability">What about a necessary condition for identifiability?</h2>
<p>Our stated <strong>test is sufficient but not necessary</strong> for identifiability. Is there a necessary and sufficient condition? Yes, <a href="https://ftp.cs.ucla.edu/pub/stat_ser/r327.pdf">there is such an algorithm by Pearl and Shipster (PDF)</a>. It extends the ideas we’ve seen in this post and returns an estimator of the causal effect in question in terms of pre-intervention probabilities. It is complete and equivalent to Pearl’s do-calculus.</p>
<p>In R, the <code>causaleffect</code> package has an implementation of this algorithm. It can be used thus for our first example:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="2020-07-31-causality-testing-identifiability_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>first_example_igraph <span class="ot">&lt;-</span> <span class="fu">graph.formula</span>(x <span class="sc">-+</span> z_2,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                                      z_2 <span class="sc">-+</span> x, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                                      x <span class="sc">-+</span> z_1,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                                      z_2 <span class="sc">-+</span> z_1,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                                      z_1 <span class="sc">-+</span> y,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                                      y <span class="sc">-+</span> z_1,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                                      x <span class="sc">-+</span> y,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                                      z_1 <span class="sc">-+</span> y,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                                      z_2 <span class="sc">-+</span> y, <span class="at">simplify =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">set.edge.attribute</span>(<span class="st">"description"</span>, <span class="at">index =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>), <span class="st">"U"</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>ce <span class="ot">&lt;-</span> <span class="fu">causal.effect</span>(<span class="at">y =</span> <span class="st">"y"</span>, <span class="at">x =</span> <span class="st">"x"</span>, <span class="at">z =</span> <span class="cn">NULL</span>, <span class="at">G =</span> first_example_igraph, <span class="at">expr =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">TeX</span>(ce), <span class="at">cex =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2020-07-31-causality-testing-identifiability_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>In Semi-Markovian models, we have hidden common causes between our variables that can derail all of our identification strategies. We’ve seen that a sufficient test for identifiability is given by the nature of the hidden common causes that we represent with bi-directed edges. If there’s a bi-directed path between <span class="math inline">\(X\)</span> and its descendants that are also ancestors of <span class="math inline">\(Y\)</span>, the causal effect is non-identifiable.</p>
<p>We’ve also presented a sufficient and necessary condition and showed how to use it in R. The condition is complete and, when the effect is identifiable, returns an estimator that we can use to estimate the causal effect using observational data.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
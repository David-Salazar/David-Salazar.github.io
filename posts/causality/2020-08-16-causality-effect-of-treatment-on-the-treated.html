<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.262">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">
<meta name="dcterms.date" content="2020-08-16">

<title>David Salazar - Causality: Regret? Look at Effect of Treatment on the Treated</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">David Salazar</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html">
 <span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/David-Salazar"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/DavidSalazarVir"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Causality: Regret? Look at Effect of Treatment on the Treated</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 16, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-read-this" id="toc-why-read-this" class="nav-link active" data-scroll-target="#why-read-this">Why read this?</a></li>
  <li><a href="#a-motivating-binary-example" id="toc-a-motivating-binary-example" class="nav-link" data-scroll-target="#a-motivating-binary-example">A Motivating binary example</a>
  <ul class="collapse">
  <li><a href="#expressing-ett-in-terms-of-observational-data-and-experimental-data" id="toc-expressing-ett-in-terms-of-observational-data-and-experimental-data" class="nav-link" data-scroll-target="#expressing-ett-in-terms-of-observational-data-and-experimental-data">Expressing ETT in terms of observational data and experimental data</a></li>
  <li><a href="#going-back-to-joe" id="toc-going-back-to-joe" class="nav-link" data-scroll-target="#going-back-to-joe">Going back to Joe</a></li>
  </ul></li>
  <li><a href="#the-more-general-case" id="toc-the-more-general-case" class="nav-link" data-scroll-target="#the-more-general-case">The more general case</a>
  <ul class="collapse">
  <li><a href="#identifiability-using-c-components" id="toc-identifiability-using-c-components" class="nav-link" data-scroll-target="#identifiability-using-c-components">Identifiability using C-components</a></li>
  <li><a href="#confirming-our-former-result" id="toc-confirming-our-former-result" class="nav-link" data-scroll-target="#confirming-our-former-result">Confirming our former result</a></li>
  <li><a href="#not-identifiable" id="toc-not-identifiable" class="nav-link" data-scroll-target="#not-identifiable">Not identifiable</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="why-read-this" class="level2">
<h2 class="anchored" data-anchor-id="why-read-this">Why read this?</h2>
<p>Regret about our actions stems from a <a href="https://david-salazar.github.io/2020/08/10/causality-counterfactuals-clash-of-worlds/"><strong>counterfactual question</strong></a>: <em>What if I had acted differently?</em>. Therefore, to answer such question, we need a more elaborate language than the one we need to answer prediction or intervention questions. Why? Because we need to compare <strong>what happened</strong> with <em>what would had happened</em> if we <strong>had acted differently</strong>. We need to compute the <strong>Effect of Treatment on the Treated (ETT)</strong>.</p>
<p>To compute the ETT, we need to formulate a Structural Causal Model and leverage the <strong>invariant qualities</strong> across the <em>observed world and the hypothetical</em> world: the unobserved background variables. Indeed, the definition of the Effect of Treatment on the Treated (ETT) is defined for a binary treatment thus:</p>
<p><span class="math display">\[
E[Y_1 - Y_0 | X = 1] \\
= \sum_u [P(y_1 | x_1, u) - P(y_1 | x_0, u)] P(u |x_1)
\]</span></p>
<p>Of course, we don’t have access to the background variables. In this post, we will learn to answer two questions: <strong>when is the ETT identifiable?</strong> And if so, can we give an <strong>estimator</strong> for such counterfactual <em>in terms of non-experimental data</em>?</p>
<p>We will first study a binary treatment and answer both questions. Then, we will tackle the more general case of any treatment.</p>
</section>
<section id="a-motivating-binary-example" class="level2">
<h2 class="anchored" data-anchor-id="a-motivating-binary-example">A Motivating binary example</h2>
<p>The following example is taken from Pearl’s (et alter) book <a href="http://bayes.cs.ucla.edu/PRIMER/">Causal Inference in Statistics: A primer</a>.</p>
<blockquote class="blockquote">
<p>Imagine an average adolescent: Joe. He has started smoking ever since he began High School. Should he regret his decision? That is, given that he has started smoking, has he significantly increased his chances of suffering from lung cancer compared to his chances had he never begun in the first place?</p>
</blockquote>
<p>Therefore, what Joe cares about is the <strong>Effect of Treatment on the Treated</strong>: <span class="math inline">\(E[Cancer_1 - Cancer_0 | Smoking = 1]\)</span>. If ETT &gt; 0, having smoked has caused a higher chance of lung cancer for Joe compared to the hypothetical world where he had never smoked in the first place. How can we calculate the ETT?</p>
<p><span class="math display">\[
\begin{aligned}
E T T &amp;=E\left[Y_{x}-Y_{x^{\prime}} \mid X=x\right] \\
&amp;=E[Y_x \mid X=x]-E\left[Y_{x^{\prime}} \mid X=x\right]
\end{aligned}
\]</span></p>
<p>The challenge, thus, is to estimate the counterfactual expression <span class="math inline">\(E\left[Y_{x^{\prime}} \mid X=x\right]\)</span></p>
<section id="expressing-ett-in-terms-of-observational-data-and-experimental-data" class="level3">
<h3 class="anchored" data-anchor-id="expressing-ett-in-terms-of-observational-data-and-experimental-data">Expressing ETT in terms of observational data and experimental data</h3>
<p>Our treatment is binary. Therefore, let’s begin by using the law of total probability thus to write <span class="math inline">\(E[Y_x]\)</span></p>
<p><span class="math display">\[
E\left[Y_{x}\right]=E\left[Y_{x} \mid X=x\right] P(X=x)+E\left[Y_{x} \mid X=x^{\prime}\right] P\left(X=x^{\prime}\right)
\]</span></p>
<p>We will use the consistency axiom: <span class="math inline">\(E[Y_x | X = x] = E[Y | X = x]\)</span>; that is, a counterfactual predicated on an actual observation is no counterfactual.</p>
<p>Therefore, we can re-write the above expression thus:</p>
<p><span class="math display">\[
E\left[Y_{x}\right]=E[Y \mid X=x] P(X=x)+E\left[Y_{x} \mid X=x^{\prime}\right] P\left(X=x^{\prime}\right)
\]</span></p>
<p>In the above expression there’s only one term that cannot be computed using observational data, <span class="math inline">\(E\left[Y_{x} \mid X=x^{\prime}\right]\)</span>: the same term that causes trouble in our ETT estimation. Let’s solve for it:</p>
<p><span class="math display">\[
E\left[Y_{x} \mid X=x^{\prime}\right]=\frac{E\left[Y_{x'}\right]-E[Y \mid X=x] P(X=x)}{P\left(X=x^{\prime}\right)} \\
E\left[Y_{x} \mid X=x^{\prime}\right]=\frac{E\left[Y | do(X = X')\right]-E[Y \mid X=x] P(X=x)}{P\left(X=x^{\prime}\right)}
\]</span></p>
<p>By plugging-in this term, we can express our ETT with terms that can be computed with a mix of observational and experimental data.</p>
<p><span class="math display">\[
\begin{aligned}
E T T &amp;=E\left[Y_{x}-Y_{x^{\prime}} \mid X=x\right] \\
&amp;=E[Y \mid X=x]-E\left[Y_{x^{\prime}} \mid X=x\right] \\
&amp;=E[Y \mid X=x]-\frac{E\left[Y \mid d o\left(X=x^{\prime}\right)\right]-E\left[Y \mid X=x^{\prime}\right] P\left(X=x^{\prime}\right)}{P(X=x)}
\end{aligned}
\]</span></p>
<p>Therefore, if the treatment is binary, whenever the causal effect of <span class="math inline">\(X\)</span> can be identified, the ETT can also be identified.</p>
</section>
<section id="going-back-to-joe" class="level3">
<h3 class="anchored" data-anchor-id="going-back-to-joe">Going back to Joe</h3>
<p>Let’s go back to our motivating example. We can express the ETT using the above derivation:</p>
<p><span class="math display">\[
\begin{aligned}
E T T &amp;=E\left[Y_{1}-Y_{0} \mid X=1\right] \\
&amp;=E[Y \mid X=1]-E\left[Y_{0} \mid X=1\right] \\
&amp;=E[Y \mid X=1]-\frac{E[Y \mid d o(X=0)]-E[Y \mid X=0] P(X=0)}{P(X=1)}
\end{aligned}
\]</span></p>
<p>Thus, we can estimate the ETT with only observational data if we can estimate <span class="math inline">\(E[Y \mid d o(X=0)]\)</span> with observational data. Given that we know that we cannot estimate causal effects without making causal assumptions, let’s formulate ours.</p>
<p>Let’s say that our causal DAG for the effects of Smoking on Cancer is the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="fu">dagify</span>(x <span class="sc">~</span> u,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                  m <span class="sc">~</span> x,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                  y <span class="sc">~</span> u <span class="sc">+</span> m,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"x"</span> <span class="ot">=</span> <span class="st">"Smoking"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"y"</span> <span class="ot">=</span> <span class="st">"Cancer"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"m"</span> <span class="ot">=</span> <span class="st">"Tar"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"u"</span> <span class="ot">=</span> <span class="st">"Genotype"</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">latent =</span> <span class="st">"u"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">exposure =</span> <span class="st">"x"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">outcome =</span> <span class="st">"y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="2020-08-16-causality-effect-of-treatment-on-the-treated_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Therefore, we can use the <a href="https://david-salazar.github.io/2020/07/30/causality-the-front-door-criterion/">front-door formula</a> to estimate the causal effect of smoking: <span class="math inline">\(E\left[Y \mid d o\left(X=x^{\prime}\right)\right]\)</span>.</p>
<p>Suppose, then, that we collect the following data:</p>
<p><img src="https://cdn.mathpix.com/snip/images/6n3SO6qiX30qj9G6jSntJnaSnlZfjaUZv2rdgmlqxbk.rendered.fullsize.png" class="img-fluid"></p>
<p>Then, using the front-door criterion, the causal effect <span class="math inline">\(E[Y \mid d o(X=0)]\)</span> is:</p>
<p><span class="math display">\[
\begin{aligned}
E[Y \mid d o(X=0)]=&amp; \sum_{z} P(Z=z \mid X=0) \sum_{x^{\prime}} P\left(Y=1 \mid X=x^{\prime}, Z=z\right) P\left(X=x^{\prime}\right) \\
=&amp; P(Z=1 \mid X=0)[P(Y=1 \mid X=1, Z=1) P(X=1)\\
&amp;+P(Y=1 \mid X=0, Z=1) P(X=0)] \\
&amp;+P(Z=0 \mid X=0)[P(Y=1 \mid X=1, Z=0) P(X=1)\\
&amp;+P(Y=1 \mid X=0, Z=0) P(X=0)] \\
=&amp; 20 / 400 *[0.15 * 0.5+0.95 * 0.5]+380 / 400 *[0.1 * 0.5+0.9 * 0.5] \\
=&amp; 0.5025
\end{aligned}
\]</span></p>
<p>Finally, we can calculate the ETT for Joe:</p>
[
<span class="math display">\[\begin{aligned}
E T T &amp;=E\left[Y_{1}-Y_{0} \mid X=1\right] \\
&amp;=E[Y \mid X=1]-E\left[Y_{0} \mid X=1\right] \\
&amp;=E[Y \mid X=1]-\frac{E[Y \mid d o(X=0)]-E[Y \mid X=0] P(X=0)}{P(X=1)} \\
&amp;=0.15-\frac{0.5025-0.9025 * 0.5}{0.5} \\
&amp;=0.0475&gt;0
\end{aligned}\]</span>
<p>]</p>
<p>Therefore, given that <span class="math inline">\(ETT&gt;0\)</span>, <strong>by smoking Joe has increased his chances of suffering from Cancer</strong>. Thus, he <em>should</em> feel regret: the <em>causal effect</em> smoking has had <strong>in his life</strong> has been to increase his chances of suffering from cancer, relative to those chances in the hypothetical world where he never smoked in the first place.</p>
</section>
</section>
<section id="the-more-general-case" class="level2">
<h2 class="anchored" data-anchor-id="the-more-general-case">The more general case</h2>
<p>Let’s say that our treatment is discrete, but not binary. Is the Effect of Treatment on the Treated (ETT) identifiable? <a href="https://arxiv.org/abs/1205.2615">Pearl and Shipster</a> have given an answer to this question using <a href="https://david-salazar.github.io/2020/07/31/causality-testing-identifiability/"><strong>C-components</strong></a></p>
<section id="identifiability-using-c-components" class="level3">
<h3 class="anchored" data-anchor-id="identifiability-using-c-components">Identifiability using C-components</h3>
<p>Remember, two variables are assigned to the same c-component iff <em>they are connected by a bi-directed path</em>. The c-components themselves induce a factorization of the joint probability distribution in terms of <strong>c-factors</strong>: post-intervention distribution of the variables in the respective c-component under an intervention on all the other variables.</p>
<p>Just as before the causal effect was identified when <span class="math inline">\(X\)</span> and its children are in different C-components (i.e., there’s no bi-directed path between <span class="math inline">\(X\)</span> and its children that are also ancestors of <span class="math inline">\(Y\)</span>), the <em>necessary counterfactual expression</em> to <strong>compute the ETT</strong>, <span class="math inline">\(P(Y_x = y|x')\)</span>, <strong>is identifiable if and only if</strong> <span class="math inline">\(X\)</span> and its children are in different C-components.</p>
<p>Indeed, whereas before (when we were trying to estimate the causal effect) we summed out <span class="math inline">\(x\)</span> from the <em>c-factor</em>, we now replace <span class="math inline">\(x\)</span> by <span class="math inline">\(x'\)</span> <a href="(https://david-salazar.github.io/2020/07/31/causality-testing-identifiability/)">from the c-factor and divide by <span class="math inline">\(P(x')\)</span></a>. Then, we take the decomposition induced by the c-factors and marginalize and condition on the appropriate variables to get the variable of interest.</p>
<p>That is, the same test is a sufficient test for causal effects identifiability and both a necessary and sufficient test for ETT identifiability.</p>
</section>
<section id="confirming-our-former-result" class="level3">
<h3 class="anchored" data-anchor-id="confirming-our-former-result">Confirming our former result</h3>
<p>Let’s take our former example of the causal model of Smoking on Cancer. This time, we will use bi-directed paths to show that there’s an unobserved confounder:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="fu">dagify</span>(x <span class="sc">~</span><span class="er">~</span> y,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                  m <span class="sc">~</span> x,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                  y <span class="sc">~</span> m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_dagitty</span>(example, <span class="at">layout =</span> <span class="st">"nicely"</span>, <span class="at">seed =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">node_descendants</span>(<span class="st">"x"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linetype =</span> <span class="fu">if_else</span>(direction <span class="sc">==</span> <span class="st">"-&gt;"</span>, <span class="st">"solid"</span>, <span class="st">"dashed"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend, <span class="at">edge_linetype =</span> linetype, <span class="at">color =</span> descendant)) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="fu">aes</span>(<span class="at">end_cap =</span> ggraph<span class="sc">::</span><span class="fu">circle</span>(<span class="dv">10</span>, <span class="st">"mm"</span>))) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>() <span class="sc">+</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The ETT is identifiable!"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Because there's no bi-directed path between x and m"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2020-08-16-causality-effect-of-treatment-on-the-treated_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Since <span class="math inline">\(X\)</span> has no bi-directed path to its child <span class="math inline">\(m\)</span>, the counterfactual query <span class="math inline">\(P(Y_x = y | x')\)</span> is identifiable. Thus, the ETT is identifiable; confirming what we have done until now.</p>
<p>However, if it were not binary, we could derive an estimator for the ETT using the induced factorization by the c-components. First, we replace with <span class="math inline">\(x'\)</span> in the c-component where <span class="math inline">\(x\)</span> is:</p>
<p><span class="math display">\[
P(x, y | do(m)) = P(y|m, x') P(x')
\]</span></p>
<p>Whereas the other c-component is</p>
<p><span class="math display">\[
P(m| do(y, x)) = P(m| do(x)) = P(m|x)
\]</span></p>
<p>Therefore, the conditional distribution on <span class="math inline">\(x'\)</span></p>
<p>Conditioning on <span class="math inline">\(x'\)</span> and marginalizing <span class="math inline">\(m\)</span>:</p>
<p><span class="math display">\[
P(y_x | x') = (\sum_z P(y| z, x') P(x') P(z | x))/(P(x'))
\]</span></p>
<p>That is, we replace <span class="math inline">\(x\)</span> with <span class="math inline">\(x'\)</span> in the c-component where <span class="math inline">\(x\)</span> is, we condition on <span class="math inline">\(x'\)</span> by dividing the joint density and marginalize <span class="math inline">\(m\)</span>. Thus, we derive the estimator for the ETT in this model by using the c-factors.</p>
</section>
<section id="not-identifiable" class="level3">
<h3 class="anchored" data-anchor-id="not-identifiable">Not identifiable</h3>
<p>Now let’s work with an example where the causal effect is identifiable, yet the <strong>counterfactual query <span class="math inline">\(P(Y_x = y | x')\)</span> is not</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>example_not <span class="ot">&lt;-</span> <span class="fu">dagify</span>(s <span class="sc">~</span><span class="er">~</span> y,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                      x <span class="sc">~</span><span class="er">~</span> s, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                      x <span class="sc">~</span> z,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                      z <span class="sc">~</span> s,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                      y <span class="sc">~</span> x</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_dagitty</span>(example_not, <span class="at">layout =</span> <span class="st">"nicely"</span>, <span class="at">seed =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linetype =</span> <span class="fu">if_else</span>(direction <span class="sc">==</span> <span class="st">"-&gt;"</span>, <span class="st">"solid"</span>, <span class="st">"dashed"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend, <span class="at">edge_linetype =</span> linetype)) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="fu">aes</span>(<span class="at">end_cap =</span> ggraph<span class="sc">::</span><span class="fu">circle</span>(<span class="dv">10</span>, <span class="st">"mm"</span>))) <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>() <span class="sc">+</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The ETT is not identifiable"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"X is connected by a bi-directed path with S"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2020-08-16-causality-effect-of-treatment-on-the-treated_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<p>We’ve seen how regret is logically defined in terms of the Effect of Treatment on the Treated (ETT). We’ve also realized what are the conditions for the ETT to be identifiable and how to derive an estimator for it in terms of observational data.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
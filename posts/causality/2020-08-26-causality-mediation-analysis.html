<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.262">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">
<meta name="dcterms.date" content="2020-08-26">

<title>David Salazar - Causality: Mediation Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">David Salazar</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html">
 <span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/David-Salazar"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/DavidSalazarVir"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Causality: Mediation Analysis</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 26, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#counterfactual-definitions" id="toc-counterfactual-definitions" class="nav-link" data-scroll-target="#counterfactual-definitions">Counterfactual Definitions</a>
  <ul class="collapse">
  <li><a href="#control-freak" id="toc-control-freak" class="nav-link" data-scroll-target="#control-freak">Control freak</a></li>
  <li><a href="#natural-let-it-flow" id="toc-natural-let-it-flow" class="nav-link" data-scroll-target="#natural-let-it-flow">Natural: Let it flow</a></li>
  <li><a href="#response-fractions" id="toc-response-fractions" class="nav-link" data-scroll-target="#response-fractions">Response fractions</a></li>
  </ul></li>
  <li><a href="#identification" id="toc-identification" class="nav-link" data-scroll-target="#identification">Identification</a>
  <ul class="collapse">
  <li><a href="#examples-of-identification" id="toc-examples-of-identification" class="nav-link" data-scroll-target="#examples-of-identification">Examples of Identification</a></li>
  </ul></li>
  <li><a href="#numerical-example" id="toc-numerical-example" class="nav-link" data-scroll-target="#numerical-example">Numerical example</a></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>extrafont<span class="sc">::</span><span class="fu">loadfonts</span>(<span class="at">device=</span><span class="st">"win"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_dag</span>(<span class="at">base_family =</span> <span class="st">"Roboto Condensed"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<p>Kids are the prototypical question makers; they never stop asking questions. Just after you have answered a <strong>Why?</strong> question, they ask yet another <em>Why</em>? This is the problem of mediation analysis: if you answer that <em>X causes Y</em>, how does exactly <strong>the causal mechanism work</strong>? Is the causal <strong>effect direct or mediated</strong> through yet another variable M? Mediation analysis aims to disentangle the <strong>direct effect</strong> (which does not pass through the mediator) from the indirect effect (the part that passes through the mediator).</p>
<p>Judah Pearl has formulated an answer to the mediation problem by using counterfactuals. By giving precise counterfactual interpretations to both the <strong>Natural Direct Effects (NDE)</strong> and the <strong>Natural Indirect Effects (NIE)</strong>, we can use the machinery of Causal Inference to solve the mediation problem.</p>
<p>In this post, we’ll study the <strong>counterfactual definition and identification criteria</strong> behind <em>direct and indirect effects</em>. Finally, we’ll solve a numerical example to put what we have learnt into practice.</p>
<p>All quotes come from Chapter 9 of Pearl’s Causality and Chapter 4 of his primer.</p>
</section>
<section id="counterfactual-definitions" class="level2">
<h2 class="anchored" data-anchor-id="counterfactual-definitions">Counterfactual Definitions</h2>
<p>We will use the following canonical Structural Model for a mediation problem to define the following direct and indirect effects.</p>
<p><span class="math display">\[
t=f_{T}\left(u_{T}\right) \quad m=f_{M}\left(t, u_{M}\right) \quad y=f_{Y}\left(t, m, u_{Y}\right)
\]</span> Let <span class="math inline">\(T\)</span> be a binary treatment.</p>
<section id="control-freak" class="level3">
<h3 class="anchored" data-anchor-id="control-freak">Control freak</h3>
<p>So far, we have studied the total causal effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>: <span class="math inline">\(P(Y|do(X))\)</span>. “The term “direct effect” is meant to quantify an effect that is not mediated by other variables in the model or, more accurately, the sensitivity of <span class="math inline">\(Y\)</span> to changes in <span class="math inline">\(X\)</span> while all other factors in the analysis are held fixed”. Notice that holding variables fixed implies an <strong>intervention</strong> that <em>cannot always</em> be mimicked by <strong>conditioning</strong>.</p>
<p>We will label this effect the <strong>Controlled Direct Effect (CDE)</strong>. In counterfactual terms, it is defined thus:</p>
[
<span class="math display">\[\begin{aligned}
\operatorname{CDE}(m) &amp;=E\left[Y_{1, m}-Y_{0, m}\right] \\
&amp;=E[Y \mid d o(T=1, M=m)]-E[Y \mid d o(T=0, M=m)]
\end{aligned}\]</span>
<p>]</p>
<blockquote class="blockquote">
<p>CDE measures the expected increase in ( Y ) as the treatment changes from ( T=0 ) to ( T=1, ) while the mediator is set to a specified level ( M=m ) uniformly over the entire population.</p>
</blockquote>
<p>However, intervening on the mediator is an over-kill. We need to be more intelligent.</p>
</section>
<section id="natural-let-it-flow" class="level3">
<h3 class="anchored" data-anchor-id="natural-let-it-flow">Natural: Let it flow</h3>
<p>A less stringent intervention is defined by studying the expected increase in ( Y ) as the treatment changes from ( T=0 ) to ( T=1, ), “while the mediator is set to whatever value <em>it would have attained (for each individual) prior to the change</em>, that is, under <span class="math inline">\(T = 0\)</span>”. We will label this the <strong>Natural Direct Effect (NDE)</strong>. In counterfactual terms:</p>
<p><span class="math display">\[
N D E=E\left[Y_{1, M_{0}}-Y_{0, M_{0}}\right]
\]</span> Whereas the CDE is made out of do-expressions, the NDE is defined in terms of <em>nested counterfactuals</em>. Therefore, according to <a href="https://david-salazar.github.io/2020/08/10/causality-counterfactuals-clash-of-worlds/">Pearl’s Ladder of Causation and Bareinboim’s Causal Hierarchy Theorem</a>, NDE requires a <strong>more elaborate causal knowledge</strong> to be <em>identified</em> than the CDE. That is, whereas the CDE could be estimated using experimental evidence, the NDE, in principle, cannot be estimated using <strong>only</strong> experimental evidence.</p>
<section id="what-about-indirect-effects" class="level4">
<h4 class="anchored" data-anchor-id="what-about-indirect-effects">What about indirect effects?</h4>
<p>Once we have defined a direct effect, the natural thing to do, in order to tackle the mediation problem, is to also define an <em>indirect</em> effect. The comparison of the two terms will allow us to answer the mediation problem.</p>
<p>Notice that we must define the <strong>Natural Indirect Effect (NIE)</strong> such that it measures “the portion of the effect that can be explained by mediation alone. Thus, it must disable the capacity of <span class="math inline">\(Y\)</span> to respond to <span class="math inline">\(X\)</span>”. To do so, we will define the NIE thus:</p>
<blockquote class="blockquote">
<p>NIE measures the expected increase in Y when the treatment is held constant, at <span class="math inline">\(T = 0\)</span>, and <span class="math inline">\(M\)</span> changes to whatever value it would have attained (for each individual) under <span class="math inline">\(T=1\)</span>.</p>
</blockquote>
<p>In counterfactual language:</p>
<p><span class="math display">\[
N I E=E\left[Y_{0, M_{1}}-Y_{0, M_{0}}\right]
\]</span> Just like with the NDE, we are faced with nested counterfactuals that cannot always be estimated using experimental evidence.</p>
</section>
</section>
<section id="response-fractions" class="level3">
<h3 class="anchored" data-anchor-id="response-fractions">Response fractions</h3>
<p>To answer the mediation question, it is useful to state the direct and indirect effects in terms of the total effect.</p>
<p>What percentage is due to the <strong>direct effect</strong> of <span class="math inline">\(X\)</span>? The ratio <span class="math inline">\(NDE/TE\)</span> “measures the fraction of the response that is transmitted directly, with <span class="math inline">\(M\)</span> frozen.”</p>
<p>What percentage is due to the mediator variable, that is, is due to the <strong>indirect effect</strong> of <span class="math inline">\(X\)</span>?</p>
<blockquote class="blockquote">
<p><span class="math inline">\(NIE∕TE\)</span> measures the fraction of the response that <strong>may be</strong> transmitted through <span class="math inline">\(M\)</span>, with <span class="math inline">\(Y\)</span> blinded to <span class="math inline">\(X\)</span>. Consequently, the difference <span class="math inline">\((TE − NDE)∕TE\)</span> measures the fraction of the response that <strong>is necessarily</strong> due to M.</p>
</blockquote>
</section>
</section>
<section id="identification" class="level2">
<h2 class="anchored" data-anchor-id="identification">Identification</h2>
<p>Because both the NDE and the NIE are defined with <em>nested counterfactuals</em>, they imply a contradiction between two <strong>different and clashing causal worlds</strong> that can only be resolved through the invariant information across worlds. However, not all structural causal models (SCM) imply enough restrictions such that this invariant information is enough to estimate the nested counterfactuals with a combination of <strong>observational and experimental evidence</strong>.</p>
<p>What type of causal models yield NDE (and NIE) that are identifiable? In <a href="">this paper</a>, Pearl says that every model where there is a set <span class="math inline">\(w\)</span> of measured covariates such that:</p>
<ol type="1">
<li><p>No member of <span class="math inline">\(W\)</span> is a descendant of <span class="math inline">\(T\)</span>.</p></li>
<li><p><span class="math inline">\(W\)</span> blocks all backdoor paths from <span class="math inline">\(M\)</span> to <span class="math inline">\(Y\)</span> not traversing <span class="math inline">\(T\)</span>. That is, <span class="math inline">\(W\)</span> deconfounds the mediator-outcome relationship (holding <span class="math inline">\(T\)</span> constant).</p></li>
</ol>
<p>Then, both effects (NDE and NIE) are <strong>identifiable</strong> with <em>experimental evidence</em>. The formula for the NDE becomes thus:</p>
<p><span class="math display">\[
\begin{aligned}
N D E=\sum_{m} \sum_{w}\left[E(Y \mid d o(T=1, M=m)), W=w)-E(Y \mid d o(T=0, M=m), W=w)\right] \\
P(M=m \mid d o(T=0), W=w) P(W=w)
\end{aligned}
\]</span></p>
<p>The intuition is the following:</p>
<blockquote class="blockquote">
<p>The natural direct effect is the weighted average of the controlled direct effect ( C D E(m), ) shown in the square brackets, using the no-treatment distribution ( P(M=m T=0) ) as a weighting function.</p>
</blockquote>
<p>Furthermore, if we require <strong>identification</strong> with <em>observational data</em>, we must have a causal model where, <em>besides</em> the former two assumptions, the following two assumptions also hold:</p>
<ul>
<li>The ( W ) -specific effect of the treatment on the mediator is identifiable by some means. [ [P(m d o(t), w) ] ]</li>
<li>The ( W ) -specific joint effect of ( { ) treatment ( + ) mediator ( } ) on the outcome is identifiable by some means. [ [P(y d o(t, m), w) ] ]</li>
</ul>
<p>Then, the equation for the NDE (and the NIE) becomes:</p>
<p><span class="math display">\[
\begin{equation}
\begin{array}{c}
N D E=\sum_{m} \sum_{w}[E(Y \mid T=1, M=m, W=w)-E(Y \mid T=0, M=m, W=w)] \\
P(M=m \mid T=0, W=w) P(W=w) \\
N I E=\sum_{m} \sum_{w}[P(M=m \mid T=1, W=w)-P(M=m \mid T=0, W=w)] \\
E(Y \mid T=0, M=m, W=w) P(W=w)
\end{array}
\end{equation}
\]</span></p>
<p>Finally, if there is no confounding in our causal model whatsoever, there’s no need fo conditioning on <span class="math inline">\(W\)</span> and we arrive at the <strong>mediation formulas</strong>:</p>
<p><span class="math display">\[
NDE = \sum_{m}[E[Y \mid T=1, M=m]-E[Y \mid T=0, M=m]] P(M=m \mid T=0)
\]</span> Similarly, for the NIE the mediation formula is the following:</p>
<p><span class="math display">\[
N I E=\sum_{m} E[Y \mid T=0, M=m][P(M=m \mid T=1)-P(M=m \mid T=0)]
\]</span> In the following section, I’ll present four examples of causal models where the NDE and NIE may not be identifiable.</p>
<section id="examples-of-identification" class="level3">
<h3 class="anchored" data-anchor-id="examples-of-identification">Examples of Identification</h3>
<section id="first-example" class="level4">
<h4 class="anchored" data-anchor-id="first-example">First example</h4>
<p>Suppose you have the following causal model. Are the NDE and NIE identifiable?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>first_example <span class="ot">&lt;-</span> <span class="fu">dagify</span>(y <span class="sc">~</span> t <span class="sc">+</span> m,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                        m <span class="sc">~</span> t)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(first_example) <span class="sc">+</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Are the NDE and NIE identifiable?"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Given that there's no confounding, they are identifiable!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2020-08-26-causality-mediation-analysis_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Yes, the effects are identifiable: there’s no confounding and we can use the <strong>mediator formulas</strong>.</p>
</section>
<section id="second-example" class="level4">
<h4 class="anchored" data-anchor-id="second-example">Second example</h4>
<p>Suppose you have the following causal model. Are the NDE and NIE identifiable?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>second_example <span class="ot">&lt;-</span> <span class="fu">dagify</span>(y <span class="sc">~</span> t <span class="sc">+</span> m <span class="sc">+</span> w,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                        m <span class="sc">~</span> t <span class="sc">+</span> w,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                        t <span class="sc">~</span> w)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(second_example) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Are the NDE and NIE identifiable?"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"w confounds all three relationships. Adjusting for W, renders NDE and NIE identifiable"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2020-08-26-causality-mediation-analysis_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Yes, we can identify the NDE and the NIE. Although <span class="math inline">\(W\)</span> confounds all three relationships, by adjusting by <span class="math inline">\(W\)</span>, we can deconfound them and estimate the NDE and NIE.</p>
</section>
<section id="third-example" class="level4">
<h4 class="anchored" data-anchor-id="third-example">Third example</h4>
<p>Suppose you have the following causal model where the dashed arc represents a common unobserved ancestor. Are the NDE and NIE identifiable?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>third_example <span class="ot">&lt;-</span> <span class="fu">dagify</span>(m <span class="sc">~</span> t,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                        z <span class="sc">~</span> m,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                        y <span class="sc">~</span> z <span class="sc">+</span> t,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                        m <span class="sc">~</span><span class="er">~</span> y)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_dagitty</span>(third_example, <span class="at">layout =</span> <span class="st">"nicely"</span>, <span class="at">seed =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linetype =</span> <span class="fu">if_else</span>(direction <span class="sc">==</span> <span class="st">"-&gt;"</span>, <span class="st">"solid"</span>, <span class="st">"dashed"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend, <span class="at">edge_linetype =</span> linetype)) <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="fu">aes</span>(<span class="at">end_cap =</span> ggraph<span class="sc">::</span><span class="fu">circle</span>(<span class="dv">10</span>, <span class="st">"mm"</span>))) <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>() <span class="sc">+</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>() <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Are the NDE and NIE identifiable?"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Although the causal effect M-&gt;Y is identifiable, we cannot deconfound the relationships and</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="st">        thus cannot estimate neither the NDE nor the NIE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2020-08-26-causality-mediation-analysis_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We cannot!</p>
<blockquote class="blockquote">
<p>Unfortunately, although the causal effect of ( {T, M} ) on ( Y, ) as well as the controlled direct effect ( C D E(m) ) are both identifiable (through the front-door estimator), condition (2 ) cannot be satisfied; no covariate can be measured that deconfounds the ( M Y ) relationship. The front-door estimator provides a consistent estimate of the population causal effect, ( P(Y=y d o(M=m)), ) while unconfoundedness, as defined before, requires independence of ( U_{M} ) and ( U_{Y}, ) which measurement of ( Z ) cannot induce.</p>
</blockquote>
<p>This is yet another example of the <strong>Causal Hierarchy Theorem</strong>: experimental evidence is not enough to determine counterfactual information. In this case, causal effects are not enough to determine the nested counterfactuals that define the NDE.</p>
</section>
<section id="four-example" class="level4">
<h4 class="anchored" data-anchor-id="four-example">Four example</h4>
<p>Suppose you have the following causal model. Are the NDE and NIE identifiable?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fourth_example <span class="ot">&lt;-</span> <span class="fu">dagify</span>(y <span class="sc">~</span> t <span class="sc">+</span> m <span class="sc">+</span> w,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                        m <span class="sc">~</span> t <span class="sc">+</span> w,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                        w <span class="sc">~</span> t)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(fourth_example) <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Are the NDE and NIE identifiable?"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Although W deconfounds M-&gt;Y, it is a descendant of T. Thus, we cannot identify NDE or NIE. "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2020-08-26-causality-mediation-analysis_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>No, neither NDE nor NIE are identifiable. Given our first assumption, there’s the following “general pattern that prevents identification of natural effects in any non-parametric model”:</p>
<blockquote class="blockquote">
<p>Whenever a variable exists, be it measured or unmeasured, that is a descendant of T and an ancestor of both M and Y (W in our examples), NDE is not identifiable.</p>
</blockquote>
<p>However, the restriction does not apply to linear models where every counterfactual is identifiable once the parameters are identified. Sadly, “the increased identification power comes at increasing the danger of mis-specification”.</p>
</section>
</section>
</section>
<section id="numerical-example" class="level2">
<h2 class="anchored" data-anchor-id="numerical-example">Numerical example</h2>
<p>I’ll finish the post by giving the following numerical example to show how we can use what we’ve learnt to estimate natural effects and solve a mediation problem with data. This is the exercise 4.5.4 in Pearl’s primer.</p>
<blockquote class="blockquote">
<p>Suppose that a company is accused of gender discrimination. Let <span class="math inline">\(T = 1\)</span> standing for male applicants, <span class="math inline">\(M = 1\)</span> standing for highly qualified applicants, and <span class="math inline">\(Y = 1\)</span> standing for hiring. (Find the proportion of the hiring disparity that is due to gender, and the proportion that could be explained by disparity in qualification alone.)</p>
</blockquote>
<p>That is, there are two paths whereby there’s discrimination. Male applicants tend to get more easily hired and thus have more qualifications. However, male applicants may also be favored by the company just because they are male. We draw the following DAG:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>gender_discrimination <span class="ot">&lt;-</span> <span class="fu">dagify</span>(m <span class="sc">~</span> t,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                                y <span class="sc">~</span> m <span class="sc">+</span> t,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"m"</span> <span class="ot">=</span> <span class="st">"Qualifications"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"t"</span> <span class="ot">=</span> <span class="st">"Gender"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"y"</span> <span class="ot">=</span> <span class="st">"Hiring"</span>))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>gender_discrimination <span class="sc">%&gt;%</span>  <span class="fu">tidy_dagitty</span>(<span class="at">layout =</span> <span class="st">"tree"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_text</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_label_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">fill =</span> <span class="st">"dodgerblue4"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"white"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">family =</span> <span class="st">"Roboto Condensed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2020-08-26-causality-mediation-analysis_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s say that we collect the following data:</p>
<p><span class="math display">\[
\begin{array}{ccc}
\hline \text { Gender } &amp; \text { Qualification } &amp; \text { Success Hiring } \\
T &amp; M &amp; E(Y \mid T=t, M=m) \\
\hline 1 &amp; 1 &amp; 0.80 \\
1 &amp; 0 &amp; 0.40 \\
0 &amp; 1 &amp; 0.30 \\
0 &amp; 0 &amp; 0.20 \\
\hline
\end{array}
\]</span></p>
<p><span class="math display">\[
\begin{array}{cc}
\hline \text { Gender } &amp; \text { Qualification } \\
T &amp; E(M \mid T=t) \\
\hline 0 &amp; 0.40 \\
1 &amp; 0.75 \\
\hline
\end{array}
\]</span> Assuming that there’s no confounding, we use the <strong>mediator formulas thus</strong>:</p>
<p><span class="math display">\[
\begin{aligned}
N D E=&amp; \sum_{m}[E[Y \mid T=1, M=m]-E[Y \mid T=0, M=m]] P(M=m \mid T=0) \\
=&amp;[E[Y \mid T=1, M=0]-E[Y \mid T=0, M=0]] P(M=0 \mid T=0) \\
&amp;+[E[Y \mid T=1, M=1]-E[Y \mid T=0, M=1]] P(M=1 \mid T=0) \\
=&amp;(0.4-0.2)(1-0.4)+(0.8-0.3) 0.4 \\
=&amp; 0.32 \\
N I E=&amp; \sum_{m} E[Y \mid T=0, M=m][P(M=m \mid T=1)-P(M=m \mid T=0)] \\
=&amp; E[Y \mid T=0, M=0][P(M=0 \mid T=1)-P(M=0 \mid T=0)] \\
&amp;+E[Y \mid T=0, M=1][P(M=1 \mid T=1)-P(M=1 \mid T=0)] \\
=&amp;(0.75-0.4)(0.3-0.2) \\
=&amp; 0.035
\end{aligned}
\]</span></p>
<p>Therefore, given that the direct effect is substantially larger than the indirect effect, we conclude that it is not the different qualifications in themselves, but the gender that is driving the hiring process in the company.</p>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>Mediation analysis aims to disentangle the <strong>NDE</strong> (which does not pass through the mediator) from the <strong>NIE</strong> (the part that passes through the mediator). We’ve seen how the correct definition of these effects requires counterfactual thinking that cannot always be empirIcally identified with either experimental or observational evidence. After having stated the required assumptions for identifiability, we practiced recognizing such assumptions with several causal models. Finally, we practiced with a numerical example out of Pearl’s primer.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
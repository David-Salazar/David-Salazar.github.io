<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.262">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">
<meta name="dcterms.date" content="2020-06-17">

<title>David Salazar - Extreme Value Theory for Time Series</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">David Salazar</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html">
 <span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/David-Salazar"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/DavidSalazarVir"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Extreme Value Theory for Time Series</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 17, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-d-condtions" id="toc-the-d-condtions" class="nav-link active" data-scroll-target="#the-d-condtions">The D-Condtions</a></li>
  <li><a href="#record-breaking-observations" id="toc-record-breaking-observations" class="nav-link" data-scroll-target="#record-breaking-observations">Record breaking observations</a>
  <ul class="collapse">
  <li><a href="#a-monte-carlo-proof" id="toc-a-monte-carlo-proof" class="nav-link" data-scroll-target="#a-monte-carlo-proof">A Monte-Carlo proof</a></li>
  <li><a href="#sp500-tail-returns-independent" id="toc-sp500-tail-returns-independent" class="nav-link" data-scroll-target="#sp500-tail-returns-independent">SP500 tail returns: independent?</a></li>
  </ul></li>
  <li><a href="#generalizing-the-fisher-tippet-theorem" id="toc-generalizing-the-fisher-tippet-theorem" class="nav-link" data-scroll-target="#generalizing-the-fisher-tippet-theorem">Generalizing the Fisher-Tippet Theorem</a>
  <ul class="collapse">
  <li><a href="#consequences" id="toc-consequences" class="nav-link" data-scroll-target="#consequences">Consequences</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>The Fisher-Tippet theorem (<a href="2020-06-10-fisher-tippet-th-a-clt-for-the-sample-maxima.html">a type of CLT for the tail events</a>) rests on the assumption that the observed values are independent and identically distributed. However, in any non trivial example, time series will reflect an <strong>underlying structure</strong> that will create dependence among the observations. Indeed, tail events <em>tend</em> <strong>to occur in clusters</strong>. Does this mean that we cannot use the Extreme Value Theory (EVT) to model the maxima of a time series?</p>
<p><em>The answer?</em> Not necessarily. We can only use EVT if the maxima of the time series behave <em>like</em> they are independent. In this blogpost, I’ll give:</p>
<ol type="1">
<li>An intuitive explanation of the conditions we need to set on the time series to be able to use EVT.</li>
<li>Show how we can test whether these conditions hold for real data: S&amp;P500 returns</li>
<li>How, once the conditions hold, we can generalize the Fisher-Tippet theorem by replacing the independence assumption.</li>
</ol>
<p>Note that thorought the blogpost I assume that the time series is stationary.</p>
<section id="the-d-condtions" class="level2">
<h2 class="anchored" data-anchor-id="the-d-condtions">The D-Condtions</h2>
<p>The <strong>D-conditions limit the dependence structure</strong> between the maxima of a time series, thereby allowing us to <em>use EVT</em>. There are two of them:</p>
<ol type="1">
<li><p>The <em><span class="math inline">\(D\)</span></em> condition <strong>limits the long-range dependence</strong> between the maxima of a time series. That is, separate the time series into two intervals: the <span class="math inline">\(D\)</span> condition states that <strong>the maxima of the two separated intervals are approximately independent</strong>.</p></li>
<li><p>The <span class="math inline">\(D'\)</span> condition <strong>limits the local dependence</strong> structure between the maxima of a time series. That is, separate the time series into <em>small blocks</em>. Count as an exceedance an observation that exceeds a given large threshold. The <span class="math inline">\(D'\)</span> condition postulates that <strong>the probability of observing more than one exceedance in a block is negligible</strong>.</p></li>
</ol>
<p>If both <span class="math inline">\(D\)</span> and <span class="math inline">\(D'\)</span> are satisfied, then the dependence between far-apart maxima and local maxima is largely limited. Therefore, we can generalize the Fisher-Tippet Theorem to work with these type of time series. However, <strong>how would one check these conditions with real data</strong>?</p>
</section>
<section id="record-breaking-observations" class="level2">
<h2 class="anchored" data-anchor-id="record-breaking-observations">Record breaking observations</h2>
<p>We can <strong>compare</strong> the number of <em>record-breaking observations</em> in our time series with <strong>the expected number</strong> of record-breaking observations for <strong>independent observations</strong>. If they are roughly similar, we can conclude that both the <span class="math inline">\(D\)</span> conditions hold for our time series. Let’s begin defining how we count the number of record-breaking of observations:</p>
<p><span class="math display">\[
N_n=1+\sum_{k=2}^n1_{X_k&gt;M_{k-1}}, \quad n\geq2
\]</span> Then, it can be shown that if the observations are independent, the expected number of record-breaking observations is:</p>
<p><span class="math display">\[
E[N_n]=\sum_{k=1}^n \frac{1}{k} \approx \log n +\gamma
\]</span> Where <span class="math inline">\(\gamma\)</span> is Euler’s constant. Therefore, for independent observations, the number of record-breaking observations grows very slowly. We can also check the variance of the number of record-breaking observations for independent observations:</p>
<p><span class="math display">\[
var(N_n)= \sum_{k=1}^n \left(\frac{1}{k} - \frac{1}{k^2} \right)
\]</span> Let’s try to get some intuition for how these formulas bound the number of record breaking observations when independence holds.</p>
<section id="a-monte-carlo-proof" class="level3">
<h3 class="anchored" data-anchor-id="a-monte-carlo-proof">A Monte-Carlo proof</h3>
<p>To prove this statement, I’ll perform a Monte-Carlo experiment with <span class="math inline">\(10^4\)</span> different independent time series with marginal distribution Cauchy. For each time series, I’ll simulate 1,000 observations. Then, we can compare the Monte Carlo distribution of the number of observed record-breaking observations with the expected number.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="2020-06-17-extreme-value-theory-for-time-series_files/figure-html/number-records-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
<section id="sp500-tail-returns-independent" class="level3">
<h3 class="anchored" data-anchor-id="sp500-tail-returns-independent">SP500 tail returns: independent?</h3>
<p>We can divide the returns of the S&amp;P500 in positive and negative returns. Can we model the tail returns for either of them with EVT? As we’ve seen, the answer depends on the <span class="math inline">\(D\)</span> conditions: are the maxima too clustered? are far-apart maxima related? If the answer to both questions is no, then we can use EVT.</p>
<p>To test it out, we will compare the number of record breaking returns (both positive and negative) with the expected number of record breaking returns if the returns where independent. In this analysis, I use all the data from 1948 up to the present day and I’ll model the log returns:</p>
<div class="cell">

</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="2020-06-17-extreme-value-theory-for-time-series_files/figure-html/sp5200-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>
<section id="generalizing-the-fisher-tippet-theorem" class="level2">
<h2 class="anchored" data-anchor-id="generalizing-the-fisher-tippet-theorem">Generalizing the Fisher-Tippet Theorem</h2>
<p>If both <span class="math inline">\(D\)</span> conditions hold, we can generalize the Fisher-Tippet Theorem. Crucially, the maxima of the time series will still converge to one of the <span class="math inline">\(GEV_{\xi}\)</span> distributions. However, it will converge to a transformed version of the <span class="math inline">\(GEV\)</span> thus:</p>
<p>Let ( {X_{i}} ) be a dependent time series and let ( {<em>{i}} ) be independent variables with the same marginal distribution. Set ( M</em>{n}={X_{1}, , X_{n}} ) and ( <em>{n}={</em>{1}, , <em>{n}} . ) If the <span class="math inline">\(D\)</span> conditions hold, then: [ {(</em>{n}-b_{n}) / a_{n} z} (z), n ] if and only if [ {(M_{n}-b_{n}) / a_{n} z} G(z) ] where ( G(z)={GEV_{}}^{}(z) ) for some constant ( ) which is called the <strong>extremal index</strong> of the time series.</p>
<section id="consequences" class="level3">
<h3 class="anchored" data-anchor-id="consequences">Consequences</h3>
<ul>
<li><p>The <span class="math inline">\(\theta\)</span> is a measure of the clustering of the maxima. The lower the theta, the more clustered are the maxima.</p></li>
<li><p>If the observations are independent, <span class="math inline">\(\theta = 1\)</span>. Thus, the extremal index is a measure of dependence between the data. The smaller the extremal index, the more dependent are the maxima of the time series. In particular:</p></li>
</ul>
<p><span class="math display">\[
P(M_n &lt; x) \approx F(x)^{n\theta}
\]</span></p>
<p>Therefore, we can consider these maxima arising from a dependent time series as <em>equivalently</em> arising <strong>from <span class="math inline">\(n\theta\)</span> independent observations</strong> with the same marginal distribution.</p>
<ul>
<li>Using the independence assumption leads us <strong>to underestimate the quantiles</strong> of the possible maxima. Indeed, for a large probability p:</li>
</ul>
<p><span class="math display">\[
F^{-1}(p) \approx GEV^{-1}\left(p^{n \theta}\right)&gt;GEV^{-1}\left(p^{n}\right)
\]</span> Indeed, when considering the dependence of the data, the VaR risk (for say 99%) measure will decrease. The probability of none of the extreme events ever happening decreases. However, as we will see, when it rains, it pours.</p>
<ul>
<li>Crucially, both <span class="math inline">\({GEV_{\xi}}^{\theta}(z), {GEV_{\xi}}(z)\)</span> <em>share</em> the same shape (<span class="math inline">\(xi\)</span>) parameter: thus, <strong>they share the same tail behavior</strong>. Indeed, by raising the distribution to the power of <span class="math inline">\(\theta\)</span>, the parameters of the distribution change thus:</li>
</ul>
<p><span class="math display">\[
\tilde{\mu}=\mu-\frac{\sigma}{\xi}\left(1-\theta^{-\xi}\right), \quad \tilde{\sigma}=\sigma \theta^{\xi}, \quad \tilde{\xi}=\xi
\]</span></p>
<p>That is, when <span class="math inline">\(\xi &gt; 0\)</span> and the MDA of the distribution is the Fréchet, the location and scale parameters change thus:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="2020-06-17-extreme-value-theory-for-time-series_files/figure-html/frechet-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Why does the mean increase so much when the maxima are <span class="math inline">\(\theta\)</span> is small? The answer is in the dependence of the maxima: when <span class="math inline">\(\theta\)</span> is small, the maxima are dependent. Thus, when one of them happens, all the other events also tend to happen. <strong>When it rains, it pours</strong>.</p>
<p>To show this, I’ll simulate observations from an Autoregressive(1) Cauchy Sequence:</p>
<p><span class="math display">\[
X_t = \rho X_{t-1} + (1-\rho) Z_t \\
Z_t \sim Cauchy
\]</span></p>
<p>The larger <span class="math inline">\(\rho\)</span>, the more dependent the data. Indeed, it can be shown<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> that <span class="math inline">\(\theta = 1 - \rho\)</span>. Therefore,</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="2020-06-17-extreme-value-theory-for-time-series_files/figure-html/cauchy-rho-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>The serial dependence present in a time series <em>invalidates</em> the independence assumption in the traditional Fisher-Tippet Theorem. Nevertheless, <strong>we can still use Extreme Value Theory</strong> to model the maxima of a time series provided that the <span class="math inline">\(D\)</span> conditions hold. The <span class="math inline">\(D\)</span> conditions limit both the long-range and the local dependence between the maxima. We can test whether these <em>conditions hold in real data</em> by comparing the <strong>number of record breaking observations</strong> in the data with the expected number of record breaking observations if the observations were independent. Once these conditions hold, we can generalize the Fisher-Tippet theorem to model the maxima of time series. Indeed, the same Maximum Domain of Attractions still hold: however, we raise these distributions to the power of <span class="math inline">\(\theta\)</span>: the extremal index. The extremal index is a measure of dependence in the data. The smaller <span class="math inline">\(\theta\)</span>, the more clustered will be the maxima of the time series.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Calculating the extremal index of a class of stationary sequences<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>